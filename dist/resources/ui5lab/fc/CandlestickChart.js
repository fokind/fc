sap.ui.define(["sap/ui/core/Control","./library","ui5lab/fc/thirdparty/d3","ui5lab/fc/thirdparty/moment-with-locales"],function(t){"use strict";return t.extend("ui5lab.fc.CandlestickChart",{metadata:{library:"ui5lab.fc",properties:{width:"float",height:"float",padding:"string"},aggregations:{candles:{type:"ui5lab.fc.Candle",multiple:true}},defaultAggregation:"candles"},init:function(){var t=this;$(window).on("resize",function(){t.rerender()})},bindAggregation:function(t,e){if(!e.length)e.length=1e5;return sap.ui.core.Control.prototype.bindAggregation.apply(this,arguments)},onAfterRendering:function(){var t=this;var e=t.getCandles();if(!e||e.length<2)return;var a=this.getId();var r=this.getParent().getId();var n=t.getPadding().split(" ");var i=n.length;var l=+n[0];var g=+n[i===1?0:1];var o=+n[i<3?0:2];var d=+n[i===1?0:i===4?3:1];var s=t.getWidth();if(!s){s=$("#"+r).width()}var c=s-d-g;var h=t.getHeight();if(!h){h=$("#"+r).height()}var m=h-o-l;var f=d3.min(e,t=>t.getLow());var v=d3.max(e,t=>t.getHigh());var p=.8;var u=d3.select("#"+a).attr("width",s).attr("height",h);var C=u.select(".fcChart");C.attr("transform",`translate(${d}, ${l})`);var x=moment(e[0].getX()).toDate();var y=moment(e[1].getX()).diff(x,"m");var w=moment(e[e.length-1].getX()).add(y,"m").toDate();var b=d3.scaleTime().range([0,c]).domain([x,w]);C.select(".fcAxisBottom").attr("transform",`translate(0, ${m})`).call(d3.axisBottom(b));var A=b(moment(x).add(y,"m").toDate());var D=d3.scaleLinear().range([m,0]).domain([f,v]);C.select(".fcAxisLeft").call(d3.axisLeft(D));var X=C.select(".fcPlotArea");var B=X.selectAll().data(e).enter().append("g").classed("fcBullish",t=>t.getClose()>=t.getOpen()).classed("fcBearish",t=>t.getClose()<t.getOpen());B.append("line").classed("fcCandleShadow",true).attr("x1",t=>b(moment(t.getX()).toDate())+A/2).attr("x2",t=>b(moment(t.getX()).toDate())+A/2).attr("y1",t=>D(t.getHigh())).attr("y2",t=>D(t.getLow()));B.append("rect").classed("fcCandleBody",true).attr("x",t=>b(moment(t.getX()).toDate())+(1-p)*A/2).attr("y",t=>D(Math.max(t.getOpen(),t.getClose()))).attr("height",t=>Math.max(1,D(Math.min(t.getOpen(),t.getClose()))-D(Math.max(t.getOpen(),t.getClose())))).attr("width",p*A)}})});